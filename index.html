<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="assets/style.css" type="text/css" rel="stylesheet"/>
    <title>11 IB Kermes Satis Takip Sistemi</title>
    <script src="http://www.w3schools.com/lib/w3data.js"></script>
  </head>


  <body>

    <header>
      <a href="/" class="title">11 IB Kermes Satis Takip Sistemi</a>
    </header>
    <a href="https://docs.google.com/spreadsheets/d/1mW9xuWIBDuyZQHiYTfuMi6nvPHpZpJANE4p61JfIk5Q/edit?usp=sharing">Google Sheet</a>
    <div style="margin: 0 auto;">
      <p>Items</p>
      <div>
        <input type=button class="item-button" value="-" name="sold-item" id="kitap ayraci" onclick="buttonDec('kitap ayraci')"/>
        <input type=button class="item-button" value="+" name="sold-item" id="kitap ayraci" onclick="buttonInc('kitap ayraci')"/>
        <span id="kitap ayraci num"></span>
        <span>x Kitap Ayracı</span>
      </div>
      <div>
        <input type=button class="item-button" value="-" name="sold-item" id="ip bileklik" onclick="buttonDec('ip bileklik')"/>
        <input type=button class="item-button" value="+" name="sold-item" id="ip bileklik" onclick="buttonInc('ip bileklik')"/>
        <span id="ip bileklik num"></span>
        <span>x İp Bileklik</span>
      </div>
      <div>
        <input type=button class="item-button" value="-" name="sold-item" id="boncuk bileklik" onclick="buttonDec('boncuk bileklik')"/>
        <input type=button class="item-button" value="+" name="sold-item" id="boncuk bileklik" onclick="buttonInc('boncuk bileklik')"/>
        <span id="boncuk bileklik num"></span>
        <span>x Boncuk Bileklik</span>
      </div>
      <div>
        <input type=button class="item-button" value="-" name="sold-item" id="kupe" onclick="buttonDec('kupe')"/>
        <input type=button class="item-button" value="+" name="sold-item" id="kupe" onclick="buttonInc('kupe')"/>
        <span id="kupe num"></span>
        <span>x Küpe</span>
      </div>
      <div>
        <input type=button class="item-button" value="-" name="sold-item" id="kolye" onclick="buttonDec('kolye')"/>
        <input type=button class="item-button" value="+" name="sold-item" id="kolye" onclick="buttonInc('kolye')"/>
        <span id="kolye num"></span>
        <span>x Kolye</span>
      </div>
      <p>Foods</p>
      <div>
        <input type=button class="item-button" value="-" name="sold-item" id="mavi meth" onclick="buttonDec('mavi meth')"/>
        <input type=button class="item-button" value="+" name="sold-item" id="mavi meth" onclick="buttonInc('mavi meth')"/>
        <span id="mavi meth num"></span>
        <span>x </span><span style="color: #88c0d0">Mavi Meth</span>
      </div>
      <div>
        <input type=button class="item-button" value="-" name="sold-item" id="zencefil kurabiye" onclick="buttonDec('zencefil kurabiye')"/>
        <input type=button class="item-button" value="+" name="sold-item" id="zencefil kurabiye" onclick="buttonInc('zencefil kurabiye')"/>
        <span id="zencefil kurabiye num"></span>
        <span>x Zencefilli ve Tarçınlı Kurabiye</span>
      </div>
      <div>
        <input type=button class="item-button" value="-" name="sold-item" id="marakna salatasi" onclick="buttonDec('marakna salatasi')"/>
        <input type=button class="item-button" value="+" name="sold-item" id="marakna salatasi" onclick="buttonInc('marakna salatasi')"/>
        <span id="marakna salatasi num"></span>
        <span>x Makarna Salatası</span>
      </div>
      <div>
        <input type=button class="item-button" value="-" name="sold-item" id="alman salatasi" onclick="buttonDec('alman salatasi')"/>
        <input type=button class="item-button" value="+" name="sold-item" id="alman salatasi" onclick="buttonInc('alman salatasi')"/>
        <span id="alman salatasi num"></span>
        <span>x Alman Salatası</span>
      </div>
      <div>
        <input type=button class="item-button" value="-" name="sold-item" id="waffle" onclick="buttonDec('waffle')"/>
        <input type=button class="item-button" value="+" name="sold-item" id="waffle" onclick="buttonInc('waffle')"/>
        <span id="waffle num"></span>
        <span>x Waffle</span>
      </div>
      <div>
        <input type=button class="item-button" value="-" name="sold-item" id="browni" onclick="buttonDec('browni')"/>
        <input type=button class="item-button" value="+" name="sold-item" id="browni" onclick="buttonInc('browni')"/>
        <span id="browni num"></span>
        <span>x Browni</span>
      </div>
      <div>
        <input type=button class="item-button" value="-" name="sold-item" id="kek" onclick="buttonDec('kek')"/>
        <input type=button class="item-button" value="+" name="sold-item" id="kek" onclick="buttonInc('kek')"/>
        <span id="kek num"></span>
        <span>x Kek</span>
      </div>
      <div>
        <input type=button class="item-button" value="-" name="sold-item" id="normal kurabiye" onclick="buttonDec('normal kurabiye')"/>
        <input type=button class="item-button" value="+" name="sold-item" id="normal kurabiye" onclick="buttonInc('normal kurabiye')"/>
        <span id="normal kurabiye num"></span>
        <span>x Normal Kurabiye</span>
      </div>
      <div>
        <input type=button class="item-button" value="-" name="sold-item" id="ispanakli borek" onclick="buttonDec('ispanakli borek')"/>
        <input type=button class="item-button" value="+" name="sold-item" id="ispanakli borek" onclick="buttonInc('ispanakli borek')"/>
        <span id="ispanakli borek num"></span>
        <span>x Ispanakalı Börek</span>
      </div>
      <p>Games</p>
      <div>
        <input type=button class="item-button" value="-" name="sold-item" id="uclu" onclick="buttonDec('uclu')"/>
        <input type=button class="item-button" value="+" name="sold-item" id="uclu" onclick="buttonInc('uclu')"/>
        <span id="uclu num"></span>
        <span>x Üçlü Kupon</span>
      </div>
      <div>
        <input type=button class="item-button" value="-" name="sold-item" id="besli" onclick="buttonDec('besli')"/>
        <input type=button class="item-button" value="+" name="sold-item" id="besli" onclick="buttonInc('besli')"/>
        <span id="besli num"></span>
        <span>x Beşli Kupon</span>
      </div>
      <div>
        <input type=button class="item-button" value="-" name="sold-item" id="yedili" onclick="buttonDec('yedili')"/>
        <input type=button class="item-button" value="+" name="sold-item" id="yedili" onclick="buttonInc('yedili')"/>
        <span id="yedili num"></span>
        <span>x Yedili Kupon</span>
      </div>
    </div>

    <div style="text-align: center">
      <label for="cost">Cost: </label>
      <input type="text" id="cost" name="cost" class="cost-num" inputmode="numeric"> 
    </div>

    <div style="text-align: center">
      <!-- <input type="submit" value="Send" class="button-2" id="send-button" role="button"/> -->
      <button class="button-2" role="button" id="send-button">Send</button>
    </div>

    <div style="text-align: center">
      <b><span id="error"></span></b>
    </div>

    <footer>
      <div>
        Made by <b style="color: #bf616a;">Kutay</b>
      </div>
    </footer>

    <script>
      let buttons = document.querySelectorAll("input[name='sold-item']");
      console.log(buttons);
      let items = {};
      buttons.forEach((button) => {
        items[button.id] = 0;
        document.getElementById(button.id + " num").innerHTML = 0;
      });
      console.log(items);
      function buttonInc(id) {
        document.getElementById(id + " num").innerHTML = ++items[id];
      }
      function buttonDec(id) {
        if (items[id] == 0) return;
        document.getElementById(id + " num").innerHTML = --items[id];
      }

      const sendBtn = document.querySelector("#send-button");
      sendBtn.addEventListener('click', sendData);
      function sendData(e) {
        e.preventDefault();
        let bought = {};
        for (let key in items) {
          if (items[key] == 0) continue;
          bought[key] = items[key];
        }
        const cost = document.querySelector("#cost").value;

        if (cost == "") {
          document.getElementById("error").style = "color: #bf616a;";
          document.getElementById("error").innerHTML = "Error: No cost written.";
          return;
        } else if (Object.keys(bought).length == 0) {
          document.getElementById("error").style = "color: #bf616a;";
          document.getElementById("error").innerHTML = "Error: No items selected.";
          return;
        } else if (/^\d+$/.test(cost) == false) {
          document.getElementById("error").style = "color: #bf616a;";
          document.getElementById("error").innerHTML = "Error: Cost contains non digit characters."
          return;
        }

        document.querySelector("#cost").value = "";
        for (let key in items) {
          items[key] = 0;
          document.getElementById(key + " num").innerHTML = 0
        }

        document.getElementById("error").style = "color: #a3be8c;";
        document.getElementById("error").innerHTML = "Success!";

        fetch("/add", {
          method: "POST",
          headers: {
            Accept: "application/json",
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            "bought": bought,
            "cost": cost,
            "timeStamp": Date.now()
          })
        })
          .then(res => res.json())
          .then(data => {
            const {
              result
            } = data;
            if (result != "success") {
              console.log("something bad happened");
            }
          })
          .catch(err => console.log(err));
      }
    </script>
  </body>
</html>