<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="assets/style.css" type="text/css" rel="stylesheet"/>
    <title>11 IB Kermes Satis Takip Sistemi</title>
  </head>


  <body>

    <header>
      <a href="/" class="title">11 IB Kermes Satis Takip Sistemi</a>
    </header>
    <!-- <img src="assets/ari_logo.png" alt="The Ari logo"> -->

    <div style="margin: 0 auto">
      <!-- <ul>
        <li class="checkbox">
          <input class="checkbox-flip" name="sold-item" type="checkbox" id="kitap ayraci"/>
          <label for="kitap ayraci"><span></span>Kitap Ayraci</label>
        </li>
        <li class="checkbox">
          <input class="checkbox-flip" name="sold-item" type="checkbox" id="kek"/>
          <label for="kek"><span></span>Kek</label>
        </li>
        <li class="checkbox">
          <input class="checkbox-flip" name="sold-item" type="checkbox" id="kurabiye"/>
          <label for="kurabiye"><span></span>Kurabiye</label>
        </li>
      </ul> -->
      <div>
        <input type=button class="item-button" value="-" name="sold-item" id="kitap ayraci" onclick="buttonDec('kitap ayraci')"/>
        <input type=button class="item-button" value="+" name="sold-item" id="kitap ayraci" onclick="buttonInc('kitap ayraci')"/>
        <span id="kitap ayraci num"></span>
        <span>x Kitap Ayraci</span>
      </div>
      <div>
        <input type=button class="item-button" value="-" name="sold-item" id="kek" onclick="buttonDec('kek')"/>
        <input type=button class="item-button" value="+" name="sold-item" id="kek" onclick="buttonInc('kek')"/>
        <span id="kek num"></span>
        <span>x Kek</span>
      </div>
      <div>
        <input type=button class="item-button" value="-" name="sold-item" id="kurabiye" onclick="buttonDec('kurabiye')"/>
        <input type=button class="item-button" value="+" name="sold-item" id="kurabiye" onclick="buttonInc('kurabiye')"/>
        <span id="kurabiye num"></span>
        <span>x Kurabiye</span>
      </div>            
    </div>

    <div style="text-align: center">
      <label for="cost">Cost: </label>
      <input type="text" id="cost" name="cost" class="cost-num"> 
    </div>

    <div style="text-align: center">
      <!-- <input type="submit" value="Send" class="button-2" id="send-button" role="button"/> -->
      <button class="button-2" role="button" id="send-button">Send</button>
    </div>

    <div style="text-align: center">
      <b><span id="error"></span></b>
    </div>

    <footer>
      <div>
        Made by <b style="color: #bf616a;">Kutay</b>
      </div>
    </footer>

    <script>
      let buttons = document.querySelectorAll("input[name='sold-item']");
      let items = {};
      buttons.forEach((button) => {
        items[button.id] = 0;
        document.getElementById(button.id + " num").innerHTML = 0;
      });
      console.log(items);
      function buttonInc(id) {
        document.getElementById(id + " num").innerHTML = ++items[id];
      }
      function buttonDec(id) {
        if (items[id] == 0) return;
        document.getElementById(id + " num").innerHTML = --items[id];
      }

      const sendBtn = document.querySelector("#send-button");
      sendBtn.addEventListener('click', sendData);
      function sendData(e) {
        e.preventDefault();
        let bought = {};
        for (let key in items) {
          if (items[key] == 0) continue;
          bought[key] = items[key];
        }
        const cost = document.querySelector("#cost").value;

        if (cost == "") {
          document.getElementById("error").style = "color: #bf616a;";
          document.getElementById("error").innerHTML = "Error: No cost written.";
          return;
        } else if (Object.keys(bought).length == 0) {
          document.getElementById("error").style = "color: #bf616a;";
          document.getElementById("error").innerHTML = "Error: No items selected.";
          return;
        } else if (/^\d+$/.test(cost) == false) {
          document.getElementById("error").style = "color: #bf616a;";
          document.getElementById("error").innerHTML = "Error: Cost contains non digit characters."
          return;
        }

        document.querySelector("#cost").value = "";
        for (let key in items) {
          items[key] = 0;
          document.getElementById(key + " num").innerHTML = 0
        }

        document.getElementById("error").style = "color: #a3be8c;";
        document.getElementById("error").innerHTML = "Success!";

        fetch("/add", {
          method: "POST",
          headers: {
            Accept: "application/json",
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            "bought": bought,
            "cost": cost,
            "timeStamp": Date.now()
          })
        })
          .then(res => res.json())
          .then(data => {
            const {
              result
            } = data;
            if (result != "success") {
              console.log("something bad happened");
            }
          })
          .catch(err => console.log(err));
      }
    </script>
  </body>
</html>